<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Connect Your Stripe Account</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 40px; }
    #connectBtn { padding: 12px 24px; font-size: 16px; cursor: pointer; }
    #status { margin-top: 16px; font-weight: bold; color: darkred; }
  </style>
</head>
<body>

  <h1>Connect Your Stripe Account</h1>
  <p>Click the button below to create your Stripe Express account and start earning.</p>

  <input type="email" id="emailInput" placeholder="Your email" style="padding:8px; font-size:14px; width:250px;">
  <br><br>
  <button id="connectBtn">Connect with Stripe</button>
  <div id="status"></div>

  <script>
    const connectBtn = document.getElementById('connectBtn');
    const statusDiv = document.getElementById('status');
    const emailInput = document.getElementById('emailInput');

    connectBtn.addEventListener('click', async () => {
      const email = emailInput.value.trim();
      if (!email.includes("@")) {
        statusDiv.textContent = "Please enter a valid email.";
        return;
      }

      statusDiv.textContent = "Redirecting to Stripe...";
      connectBtn.disabled = true;

      try {
        const response = await fetch(`https://us-central1-yourspace-2026.cloudfunctions.net/createConnectAccount?email=${encodeURIComponent(email)}`);
        const data = await response.json();

        if (data.url) {
          window.location.href = data.url;
        } else if (data.error) {
          statusDiv.textContent = "Stripe error: " + data.error;
          console.error("Stripe response:", data);
          connectBtn.disabled = false;
        } else {
          statusDiv.textContent = "Unexpected response from Stripe. Check console.";
          console.error("Stripe response:", data);
          connectBtn.disabled = false;
        }
      } catch (err) {
        statusDiv.textContent = "Network or server error. Check console.";
        console.error("Fetch error:", err);
        connectBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
